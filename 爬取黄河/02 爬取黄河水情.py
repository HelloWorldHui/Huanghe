# coding=utf
"""
author=Hui_T
"""
import os
import queue
import requests
import time
import datetime
import pandas
import threading
from lxml import etree
import csv

url="http://61.163.88.227:8006/hwsq.aspx"

headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36",
    # "X-MicrosoftAjax": "Delta=true",
    # "X-Requested-With": "XMLHttpRequest",
    # "Content-Type": "application/x-www-form-urlencoded",
    }


class HuangHe(threading.Thread):
    def __init__(self,queue,num):
        threading.Thread.__init__(self)
        self.queue = queue
        self.num = num
        self.path = './data/'
        if not os.path.exists(self.path):
            os.makedirs(self.path)
    def run(self):
        while True:
            date = self.queue.get()
            try:
                # print(url)
                he(date, self.path)
            except Exception as e :
                print(date,"报错xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx")
                with open('log'+str(self.num)+'.csv','a',encoding='utf8') as f :
                    f.write(date+'\n')
            finally:
                print(date,'完成')
                self.queue.task_done()


def he(date,path):
    data = {
        'ctl00$ScriptManager1': 'ctl00$ScriptManager1|ctl00$ContentLeft$Button1',
        'ctl00$ContentLeft$menuDate1$TextBox11': date,
        '__VIEWSTATE': '/wEPDwULLTEwMDI5NzA1NzkPZBYCZg9kFgICAw9kFgICBQ9kFgJmD2QWAgIBD2QWAgIBDxYCHglpbm5lcmh0bWwF6Ew8dGFibGUgd2lkdGg9Ijk4JSIgYm9yZGVyPSIwIiBjZWxscGFkZGluZz0iMCIgY2VsbHNwYWNpbmc9IjEiIGJnY29sb3I9IiNEMUREQUEiIGFsaWduPSJjZW50ZXIiPjx0cj48dGQgaGVpZ2h0PSI0MCIgYmFja2dyb3VuZD0ic2tpbi9pbWFnZXMvbmV3bGluZWJnMy5naWYiPjx0YWJsZSB3aWR0aD0iOTglIiBib3JkZXI9IjAiIGNlbGxzcGFjaW5nPSIwIiBjZWxscGFkZGluZz0iMCI+PHRyPjx0ZCBhbGlnbj0iY2VudGVyIj48ZGl2IGNsYXNzPSdmaXJzdFRpdGxlJz7msLTmg4Xml6XmiqU8L2Rpdj48ZGl2IGNsYXNzPSdzZWNUaXRsZSc+MjAxOS0wNi0xMjwvZGl2PjwvdGQ+PC90cj48L3RhYmxlPjwvdGQ+PC90cj48L3RhYmxlPjx0YWJsZSB3aWR0aD0iOTglIiBib3JkZXI9IjAiIGNlbGxwYWRkaW5nPSIyIiBjZWxsc3BhY2luZz0iMSIgYmdjb2xvcj0iI0QxRERBQSIgYWxpZ249ImNlbnRlciIgc3R5bGU9Im1hcmdpbi10b3A6OHB4IiBjbGFzcz0ibWFpblR4dCI+PHRyPjx0ZCB3aWR0aD0iNTAlIj48dGFibGUgd2lkdGg9IjEwMCUiIGJvcmRlcj0iMCIgY2VsbHBhZGRpbmc9IjIiIGNlbGxzcGFjaW5nPSIxIiBiZ2NvbG9yPSIjRDFEREFBIiBhbGlnbj0iY2VudGVyIiBzdHlsZT0ibWFyZ2luLXRvcDo4cHgiIGNsYXNzPSJtYWluVHh0Ij48VFIgYWxpZ249J2NlbnRlcicgYmdjb2xvcj0nI0U3RTdFNycgaGVpZ2h0PScyMicgY2xhc3M9J3RhYmxlVGl0bGUnID48VEQgd2lkdGg9IjE1JSIgc3R5bGU9ImZvbnQtc2l6ZToxMXB0OyI+5rKz5ZCNPC9URD48VEQgd2lkdGg9IjI1JSIgc3R5bGU9ImZvbnQtc2l6ZToxMXB0OyI+56uZ5ZCNPC9URD48VEQgd2lkdGg9IjIwJSIgc3R5bGU9ImZvbnQtc2l6ZToxMXB0OyI+5rC05L2NPC9URD48VEQgd2lkdGg9IjIwJSIgc3R5bGU9ImZvbnQtc2l6ZToxMXB0OyI+5rWB6YePPC9URD48VEQgd2lkdGg9IjIwJSIgc3R5bGU9ImZvbnQtc2l6ZToxMXB0OyI+5ZCr5rKZ6YePPC9URD48L1RSPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7llJDkuYPkuqUgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD4yNTE2LjI0PC90ZD48dGQ+MTA3MDwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPum+mee+iuWzoeWFpeW6kzwvdGQ+PHRkPi08L3RkPjx0ZD45Nzg8L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7pvpnnvorls6Hok4TmsLTph488L3RkPjx0ZD4yNTkxLjI8L3RkPjx0ZD4oMjE0KeS6vzwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPum+mee+iuWzoeWHuuW6kzwvdGQ+PHRkPi08L3RkPjx0ZD45MzY8L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7liJjlrrbls6HlhaXlupM8L3RkPjx0ZD4tPC90ZD48dGQ+MTMzMDwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuWImOWutuWzoeiThOawtOmHjzwvdGQ+PHRkPjE3MjQuMjY8L3RkPjx0ZD4oMjYuNinkur88L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7liJjlrrbls6Hlh7rlupM8L3RkPjx0ZD4tPC90ZD48dGQ+MTQ0MDwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuWFsOW3niAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MTUxMy4wMTwvdGQ+PHRkPjE2MDA8L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7kuIvmsrPmsr8gICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD4xMjMxLjk0PC90ZD48dGQ+MTQ4MDwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuefs+WYtOWxsSAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPjEwODcuNDY8L3RkPjx0ZD45NDA8L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7lt7Tlvabpq5jli5IgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MTA0OS44NjwvdGQ+PHRkPjU3NTwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuS4iea5luays+WPoyAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD4xMDE4LjY4PC90ZD48dGQ+ODgxPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPum7hOaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5YyF5aS0ICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD4xMDAyLjQ2PC90ZD48dGQ+ODkwPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPum7hOaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5aS06YGT5ouQICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+OTg3LjI1PC90ZD48dGQ+OTE4PC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPum7hOaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5LiH5a625a+o6JOE5rC06YePPC90ZD48dGQ+OTcyLjE3PC90ZD48dGQ+KDMuNTUp5Lq/PC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPum7hOaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5LiH5a625a+o5LiK5Ye65bqTPC90ZD48dGQ+LTwvdGQ+PHRkPjEwMTA8L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7kuIflrrblr6jkuIsgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+ODk5LjY1PC90ZD48dGQ+MTAxMDwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuW6nOiwtyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+ODA4Ljg3PC90ZD48dGQ+OTkxPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPum7hOaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5ZC05aChICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD42MzcuOTk8L3RkPjx0ZD4xMDYwPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPum7hOaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+6b6Z6ZeoICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD4zNzkuNTM8L3RkPjx0ZD4xMTYwPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPuaxvuaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5rKz5rSlICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD4zNzIuMTE8L3RkPjx0ZD4yOS41PC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPuWMl+a0m+aysyAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPueKtuWktCAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MzYxLjIxPC90ZD48dGQ+MC4wOTgwPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPuazvuaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5byg5a625bGxICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+NDIwLjIyPC90ZD48dGQ+MS41NzwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7muK3msrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuWSuOmYsyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MzgxLjIyPC90ZD48dGQ+NjMuMzwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7muK3msrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuWNjuWOvyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MzM1LjA0PC90ZD48dGQ+OTU8L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7mvbzlhbMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPjMyNy41ODwvdGQ+PHRkPjExNDA8L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7lj7Llrrbmu6nok4TmsLTph488L3RkPjx0ZD4zMTcuOTk8L3RkPjx0ZD4oNC45NSnkur88L3RkPjx0ZD4tPC90ZD48L3RyPjwvdGFibGU+PC90ZD48dGQgd2lkdGg9IjUwJSI+PHRhYmxlIHdpZHRoPSIxMDAlIiBib3JkZXI9IjAiIGNlbGxwYWRkaW5nPSIyIiBjZWxsc3BhY2luZz0iMSIgYmdjb2xvcj0iI0QxRERBQSIgYWxpZ249ImNlbnRlciIgc3R5bGU9Im1hcmdpbi10b3A6OHB4IiBjbGFzcz0ibWFpblR4dCI+PFRSIGFsaWduPSdjZW50ZXInIGJnY29sb3I9JyNFN0U3RTcnIGhlaWdodD0nMjInIGNsYXNzPSd0YWJsZVRpdGxlJyA+PFREIHdpZHRoPSIxNSUiIHN0eWxlPSJmb250LXNpemU6MTFwdDsiPuays+WQjTwvVEQ+PFREIHdpZHRoPSIyNSUiIHN0eWxlPSJmb250LXNpemU6MTFwdDsiPuermeWQjTwvVEQ+PFREIHdpZHRoPSIyMCUiIHN0eWxlPSJmb250LXNpemU6MTFwdDsiPuawtOS9jTwvVEQ+PFREIHdpZHRoPSIyMCUiIHN0eWxlPSJmb250LXNpemU6MTFwdDsiPua1gemHjzwvVEQ+PFREIHdpZHRoPSIyMCUiIHN0eWxlPSJmb250LXNpemU6MTFwdDsiPuWQq+aymemHjzwvVEQ+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuS4iemXqOWzoSAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPjI3NS43NTwvdGQ+PHRkPjEyNDA8L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7lsI/mtarlupXkuIrok4TmsLTph488L3RkPjx0ZD4yNTAuOTg8L3RkPjx0ZD4oMzguNCnkur88L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7lsI/mtarlupUgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD4xMzUuMjQ8L3RkPjx0ZD4xNDkwPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPuS8iuaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5Lic5rm+ICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD4yLjM5PC90ZD48dGQ+Ni4xNTwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7kvIrmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPumZhua1keWdneS4iuiThOawtOmHjzwvdGQ+PHRkPjMwNy4zODwvdGQ+PHRkPigyLjc4KeS6vzwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7kvIrmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPumZhua1keWdneS4iuWHuuW6kzwvdGQ+PHRkPi08L3RkPjx0ZD4tPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPuS8iuaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+6b6Z6Zeo6ZWHICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MTQ4LjI5PC90ZD48dGQ+MS42NTwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7mtJvmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuWNouawjyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+LTwvdGQ+PHRkPi08L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+5rSb5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7mlYXljr/msLTlupPok4TmsLTph488L3RkPjx0ZD41MjAuNDg8L3RkPjx0ZD4oMy45Nynkur88L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+5rSb5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7mlYXljr/msLTlupPlh7rlupM8L3RkPjx0ZD4tPC90ZD48dGQ+LTwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7mtJvmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPumVv+awtCAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+OTAuNTQ8L3RkPjx0ZD4yLjEyPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPua0m+aysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+55m96ams5a+6ICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+Ny42NzwvdGQ+PHRkPjkuNzg8L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+5LyK5rSb5rKzICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+6buR55+z5YWzICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MTA4Ljg2PC90ZD48dGQ+MjMuODwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7kuLnmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuWxsei3r+WdqiAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPi08L3RkPjx0ZD4tPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPuaygeaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5LqU6b6Z5Y+jICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MTQxLjQ1PC90ZD48dGQ+MC4wNDYwPC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPuaygeaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5q2m6ZmfICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD45OS4zODwvdGQ+PHRkPjAuMzE5PC90ZD48dGQ+LTwvdGQ+PC90cj48dHIgYWxpZ249ImNlbnRlciIgYmdjb2xvcj0iI0ZGRkZGRiI+PHRkPum7hOaysyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+6Iqx5Zut5Y+jICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+OTAuODY8L3RkPjx0ZD4xNDIwPC90ZD48dGQ+KjEuMTM8L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuWkueays+a7qSAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPjczLjI5PC90ZD48dGQ+MTQ3MDwvdGQ+PHRkPioyLjMzPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7pq5jmnZEgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPjU5LjIyPC90ZD48dGQ+MTM1MDwvdGQ+PHRkPioyLjU0PC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+6buE5rKzICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7lrZnlj6MgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPjQ1LjIyPC90ZD48dGQ+MTI2MDwvdGQ+PHRkPiozLjQyPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+5aSn5riF5rKzICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5oi05p2R5Z2dPC90ZD48dGQ+LTwvdGQ+PHRkPi08L3RkPjx0ZD4tPC90ZD48L3RyPjx0ciBhbGlnbj0iY2VudGVyIiBiZ2NvbG9yPSIjRkZGRkZGIj48dGQ+5Lic5bmz5rmWICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+5Lic5bmz5rmW6ICB5rmW6JOE5rC06YePPC90ZD48dGQ+NDEuODwvdGQ+PHRkPigzLjgwKeS6vzwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7kuJzlubPmuZYgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPjx0ZD7lh7rmuZbpl7g8L3RkPjx0ZD4tPC90ZD48dGQ+LTwvdGQ+PHRkPi08L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuiJvuWxsSAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MzcuNzQ8L3RkPjx0ZD4xMDkwPC90ZD48dGQ+KjMuMDY8L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuazuuWPoyAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MjYuNjM8L3RkPjx0ZD4xMDEwPC90ZD48dGQ+KjMuMDU8L3RkPjwvdHI+PHRyIGFsaWduPSJjZW50ZXIiIGJnY29sb3I9IiNGRkZGRkYiPjx0ZD7pu4TmsrMgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+PHRkPuWIqea0pSAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD48dGQ+MTAuODwvdGQ+PHRkPjg5NTwvdGQ+PHRkPioxLjk1PC90ZD48L3RyPjwvdGFibGU+PC90ZD48L3RyPjwvdGFibGU+ZGT5RDJeZ2PCttzfUxjPfDo84k+OX56ClTjsww3diM3kww==',
        "__EVENTVALIDATION": '/wEdAANrrsp48awi/OVJK/K5L3Bo9DkLBAR+UXBBGQ1m5cY+HY5Ggl8DGIT46Qo2GBY6Yh7ZOvjTt6U7Tp+yKBWyOEKjHazU8uEHLuQDiB6NSQATYQ==',
        'ctl00$ContentLeft$Button1': '查询'
    }
    res=requests.post(url,data=data,headers=headers,timeout = 100)
    tree = etree.HTML(res.text,)
    title = tree.xpath('//*[@id="ContentRight_divfff"]/table[1]/tr/td/table/tr/td/div/text()')
    # print(title) #['水情日报', '2002-01-01']
    left_table_tr = tree.xpath('//*[@id="ContentRight_divfff"]/table[2]/tr/td[1]/table/tr')
    right_table_tr = tree.xpath('//*[@id="ContentRight_divfff"]/table[2]/tr/td[2]/table/tr')

    left_text_list = []
    for left_tr in left_table_tr:
        left_text = left_tr.xpath(".//td/text()")
        left_text = [text.strip() for text in left_text] # 去空白
        left_text_list.append(left_text)
        # print(left_text) # ['河名', '站名', '水位', '流量', '含沙量']

    right_text_list = []
    for right_tr in right_table_tr:
        right_text = right_tr.xpath(".//td/text()")
        right_text = [text.strip() for text in right_text] # 去空白
        right_text.insert(0, "")
        right_text_list.append(right_text)
    # print(len(left_text_list),len(right_text_list))


    for i in range(len(left_text_list)):
        try:
            left_text_list[i] += right_text_list[i]
        except Exception as e :
            continue

    with open(path+date+".csv",'a',encoding="gbk",newline='') as f :
        writer = csv.writer(f)
        writer.writerow(title)
        writer.writerows(left_text_list)

    # name = date+".html"
    # with open(name,'w',encoding='gbk') as f :
    #     f.write(res.text)
if __name__ == '__main__':
    t1 = time.time()

    d2 = datetime.datetime.now()
    d1 = datetime.datetime.strptime("2002-01-01","%Y-%m-%d")
    print()
    one_day = datetime.timedelta(days=1)
    shijian_list = []  # 2001-01-01 到 2019-06-13 的所有时间
    while d2>=d1:
        shijian = d1.strftime("%Y-%m-%d")
        shijian_list.append(shijian)
        # print(shijian) # 2002-01-01 2002-01-02 2002-01-03 2002-01-04 .......2019-06-13
        d1+=one_day

    # 创建线程
    num = 1
    q1 = queue.Queue()
    for x in range(50):
        worker = HuangHe(q1,num)
        worker.daemon = True
        worker.start()
    # 加入队列
    for date in shijian_list:
        q1.put(date)
    q1.join()

    # 二次爬虫
    # 创建5个线程
    num += 1
    q2 = queue.Queue()
    for x in range(5):
        worker = HuangHe(q2,num)
        worker.daemon = True
        worker.start()
    # 加入队列
    with open("log"+str(num-1)+".csv",'r',encoding='utf8') as f :
        for date in f:
            q2.put(date.strip())
    q2.join()

    t2 = time.time()
    print('理论爬取条数',len(shijian_list))
    print('耗时%s秒' %(t2-t1))
    print("结束")